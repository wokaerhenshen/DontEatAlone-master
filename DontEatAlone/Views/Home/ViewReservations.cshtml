@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@model List<DontEatAlone.Data.Place>
@{
    ViewData["Title"] = "ViewReservations";
}

@{ 
    List<DontEatAlone.Data.Reservation> reservations = new List<DontEatAlone.Data.Reservation>();

    foreach(DontEatAlone.Data.Place p in Model)
    {
        reservations.AddRange(p.Reservations);
    }
}

<script>
    function initMap() {

        function generateMarkerInfoWIndow(title, address, reservations, placeId) {
            let result = `<h5>${title}</h5><h6>${address}</h6>`
            reservations.forEach(r => {
                result += `<a href='https://localhost:44351/Home/ReservationPage/?id=${r.id}'><p>${r.title}</p></a>`
            })
            result += `<a href='https://localhost:44351/Home/CreateReservation/?id=${placeId}'><p>Create Reservation</p></a>`
            return result
        }


        function addMarker(object) {
            var marker = new google.maps.Marker({
                position: { lat: object.latitude, lng: object.longtitude },
                map: map
            })
            var infoWindow = new google.maps.InfoWindow({
                content: generateMarkerInfoWIndow(object.name, object.address, object.reservations, object.id)
            })
            marker.addListener('click', () => {
                infoWindow.open(map, marker)
            })
        }

        let options = {
            zoom: 14,
            center: { lat: 49.2827, lng: -123.1207 }
        }

        let map = new google.maps.Map(document.getElementById('map'), options)

        let markersArray = @Html.Raw(Json.Serialize(Model));

        console.log(@Html.Raw(Json.Serialize(Model)));

        markersArray.map(r => addMarker(r))
    }
</script>


<h2>View Reservations</h2>

@*<form role="form">
        <div class="form-group row">
            <label for="contain">search</label>
             <input class="form-control col-sm-10" type="text" />
             <button type="submit" class="btn btn-primary col-sm-1"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>s
        </div>
    </form>*@

<form>
    <div class="form-group row">
        <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
        <div class="col-sm-11">
            <input class="form-control" placeholder="Enter keyword..." type="text" />
        </div>
    </div>
    @if (User.IsInRole("Regular"))
    {
        <div class="form-group row">
            <div class="col-md-12">
                <p>
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        Set filters
                    </button>
                </p>
                <div class="collapse" id="collapseExample">
                    <div class="row">
                        <div class="col-md-4">
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-form-legend col-sm-2">Sex</legend>
                                    <div class="col-sm-10">
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios1" value="option1">
                                                Male
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios2" value="option2">
                                                Female
                                            </label>
                                        </div>
                                        <div class="form-check disabled">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios3" value="option3">
                                                Others
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div class="col-md-4">
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-form-legend col-md-2">Other</legend>
                                    <div class="col-md-10">
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios1" value="option1">
                                                Smoking free
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios1" value="option1">
                                                Alcohol free
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios2" value="option2">
                                                Animals free
                                            </label>
                                        </div>
                                        <div class="form-check disabled">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox" name="gridRadios" id="gridRadios3" value="option3">
                                                Kids free
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div class="col-md-4">
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-form-legend col-md-2">Age</legend>
                                    <div class="col-md-10">
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
                                                All
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1">
                                                18-34
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
                                                35-50
                                            </label>
                                        </div>
                                        <div class="form-check disabled">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios3" value="option3">
                                                51-69
                                            </label>
                                        </div>
                                        <div class="form-check disabled">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios3" value="option3">
                                                70+
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label for="inputPassword5">Cuisine</label>
                            <input type="text" id="inputPassword5" class="form-control" aria-describedby="passwordHelpBlock">
                            <small id="passwordHelpBlock" class="form-text text-muted">
                                You can specify cuisine vie comma separated values. For example: Italian, Ukrainian, Canadian, Chinese
                            </small>
                        </div>
                        <div class="col-md-4">
                            <label for="inputPassword5">Language</label>
                            <input type="text" id="inputPassword5" class="form-control" aria-describedby="passwordHelpBlock">
                            <small id="passwordHelpBlock" class="form-text text-muted">
                                You can specify languge vie comma separated values. For example: English, Russian, Italian, Chinese
                            </small>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group row">
                                <label for="example-date-input" class="col-2 col-form-label">Date</label>
                                <div class="col-10">
                                    <input class="form-control" type="date" value="2011-08-19" id="example-date-input">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="example-time-input" class="col-2 col-form-label">Time Start</label>
                                <div class="col-10">
                                    <input class="form-control" type="time" value="13:45:00" id="example-time-input">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="example-time-input" class="col-2 col-form-label">Time End</label>
                                <div class="col-10">
                                    <input class="form-control" type="time" value="13:45:00" id="example-time-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</form>
<div id="map"></div>
<h3>Results</h3>
<table class="table">
    <thead>
        <tr>
            <th scope="col">Created By</th>
            @{
                if (HttpContextAccessor.HttpContext.Request.Cookies.Where(cookie => cookie.Key == "DonotEatAlone").Any())
                {
                    <th scope="col">Evaluation</th>
                }
            }

            <th scope="col">Title</th>
            <th scope="col">Location</th>
            <th scope="col">Party Size</th>


            <th scope="col">Date and Time</th>
            <th scope="col">Status</th>
        </tr>
    </thead>
    <tbody>
        @{ 
            foreach (DontEatAlone.Data.Reservation p in reservations)
            {
            <tr>
                <th scope="row">Alex</th>
                <td>@p.Title</td>
                <td>Address</td>
                <td>@p.NumberOfPeople</td>

                <td>27 November 8PM - 12PM</td>
                <td><button onclick="window.location.href='/Home/ReservationPage/?id=@p.Id'" class="btn btn-success">Open</button></td>
            </tr>
            }
        }
    </tbody>
</table>
@if (User.IsInRole("Regular"))
{
    <div class="footnotes">
        <h6>* Specifying limitations is a premium feature.</h6>
    </div>
}